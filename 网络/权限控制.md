# 权限控制

权限控制的方式
从类别上分，有两大类：
- 认证：你是谁？–识别用户身份。
- 授权：你能做什么？–限制用户使用的功能。

权限的控制级别
从控制级别（模型）上分：
- URL级别-粗粒度
- 方法级别-细粒度
- 页面级别-自定义标签（显示）
- 数据级别-最细化的（数据）

URL级别的权限控制-粗粒度
在web.xml中配置一个过滤器filter，在过滤器中，对请求的地址进行解析，字符串截取：
url.substring()…把上下文前面的路径都截取掉，剩下user_login.action。
过滤器代码：
以通过查询数据库，来判断，当前登录用户，是否可以访问user_login.action。
url级别控制，每次请求过程中只控制一次 ，相比方法级别权限控制 是粗粒度的 ！URL级别权限控制，基于Filter实现。

方法级别的权限控制-细粒度
aop面向切面的编程，在方法执行之前，进行权限判断，如果没有权限，抛出异常，终止方法的继续运行。
自定义注解 在需要权限控制方法上， 添加需要的权限信息
代理 （Spring AOP ），在目标方法运行时 进行增强 ，通过反射技术获取目标方法上注解中权限 ， 查询数据库获取当前登陆用户具有权限，进行比较。
相比URL级别权限控制， 可以控制到服务器端执行的每个方法，一次请求中可以控制多次。

页面（显示）级别的权限控制-自定义标签
页面显示的权限控制，通常是通过 自定义标签来实现

数据级别的权限控制
在每条数据上增加一个字段，该字段记录了权限的值。数据和权限绑定。
代码，你在查询数据的时候，需要去权限和用户对应表中，通过当前登录用户的条件，查询出你的数据权限。然后再将数据权限作为一个条件，放到业务表中进行查询。从而限制了数据的访问。

权限系统的数据表设计
资源：用户要访问的目标，通常是服务中的程序或文件
权限：用户具有访问某资源的能力
角色：权限的集合，为了方便给用户授权。
用户：访问系统的’人’。
表对象实体：
- 用户(User)表：访问系统的用户，比如用户登录要用
- 权限(Function)表:系统某个功能允许访问而对应的权限
- 角色(Role)表：角色是权限的集合（权限组），方便用户授权。

表对象之间的关系：
- 用户和角色关系表：一个用户对应N个角色，一个角色可以授予N个用户—》多对多关系
- 角色和权限关系表：一个角色包含N个权限，一个权限可以属于N个角色—》多对多关系

完整的权限相关表：
URL级别权限控制包含：资源表、权限表、角色表、用户表，以及相关关系（都是多对多），共7张表。
方法级别的权限控制包含：功能权限、角色、用户，以及相关关系（都是多对多），共5张表。

但Apache Shiro框架支持的URL级别权限控制，是将资源和资源权限对应关系配置到了配置文件中，不需要表的支撑，只需要5张表了。
---------------------
作者：宏微
来源：CSDN
原文：https://blog.csdn.net/shuaicihai/article/details/58391481
版权声明：本文为博主原创文章，转载请附上博文链接！
