# SQL注入

SQL注入就是通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。
### 原理

SQL注入攻击指的是通过构建特殊的输入作为参数传入Web应用程序，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。

根据相关技术原理，SQL注入可以分为平台层注入和代码层注入。前者由不安全的数据库配置或数据库平台的漏洞所致；后者主要是由于程序员对输入未进行细致地过滤，从而执行了非法的数据查询。基于此，SQL注入的产生原因通常表现在以下几方面：①不当的类型处理；②不安全的[数据](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE/5947370)库配置；③不合理的查询集处理；④不当的错误处理；⑤转义字符处理不合适；⑥多个提交处理不当。

### 攻击

当应用程序使用输入内容来构造动态sql语句以访问数据库时，会发生sql注入攻击。如果代码使用[存储过程](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B)，而这些存储过程作为包含未筛选的用户输入的字符串来传递，也会发生sql注入。sql注入可能导致攻击者使用应用程序登陆在数据库中执行命令。相关的SQL注入可以通过测试工具[pangolin](https://baike.baidu.com/item/pangolin)进行。如果应用程序使用特权过高的帐户连接到数据库，这种问题会变得很严重。在某些[表单](https://baike.baidu.com/item/%E8%A1%A8%E5%8D%95)中，用户输入的内容直接用来构造动态sql命令，或者作为[存储过程](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B)的输入参数，这些表单特别容易受到sql注入的攻击。而许多网站程序在编写时，没有对用户输入的合法性进行判断或者程序中本身的[变量](https://baike.baidu.com/item/%E5%8F%98%E9%87%8F)处理不当，使应用程序存在安全隐患。这样，用户就可以提交一段数据库查询的代码，根据程序返回的结果，获得一些敏感的信息或者控制整个服务器，于是sql注入就发生了。

### 防护

归纳一下，主要有以下几点：

1.永远不要信任用户的输入。对用户的输入进行校验，可以通过[正则表达式](https://baike.baidu.com/item/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F)，或限制长度；对单引号和

双"-"进行转换等。

2.永远不要使用动态拼装sql，可以使用参数化的sql或者直接使用[存储过程](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B)进行数据查询存取。

3.永远不要使用[管理员](https://baike.baidu.com/item/%E7%AE%A1%E7%90%86%E5%91%98)权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。

4.不要把机密信息直接存放，加密或者hash掉密码和敏感的信息。

5.应用的异常信息应该给出尽可能少的提示，最好使用自定义的[错误信息](https://baike.baidu.com/item/%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF)对原始错误信息进行包装

6.sql注入的检测方法一般采取辅助[软件](https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6)或网站平台来检测，软件一般采用sql注入检测工具jsky，网站平台就有亿思[网站安全](https://baike.baidu.com/item/%E7%BD%91%E7%AB%99%E5%AE%89%E5%85%A8)平台检测工具。MDCSOFT SCAN等。采用[MDCSOFT-IPS](https://baike.baidu.com/item/MDCSOFT-IPS)可以有效的防御SQL注入，XSS攻击等。
