# native关键字

native关键字说明其修饰的方法是一个原生态方法，方法对应的实现不是在当前文件，而是在用其他语言（如C和C++）实现的文件中。Java语言本身不能对操作系统底层进行访问和操作，但是可以通过JNI接口调用其他语言来实现对底层的访问。

JNI是Java本机接口（Java Native Interface），是一个本机编程接口，它是Java软件开发工具箱（java Software Development Kit，SDK）的一部分。JNI允许Java代码使用以其他语言编写的代码和代码库。Invocation API（JNI的一部分）可以用来将Java虚拟机（JVM）嵌入到本机应用程序中，从而允许程序员从本机代码内部调用Java代码。

native用法：
1.编写带有native声明的方法的Java类（java文件）
2.使用javac命令编译编写的Java类（class文件）
3.使用javah -jni ****来生成后缀名为.h的头文件（.h的文件）
4.使用其他语言（C、C++）实现本地方法
5.将本地方法编写的文件生成动态链接库（dll文件）

例子：

1.java文件

```
class HelloWorld{

    public native void hello(String name);

    static{
        System.loadLibrary("hello");
    }

    public static void main(String[] args){
        new HelloWorld().hello("jni");
    }

}
```

2.javac命令编译

```
javac HelloWorld.java
```

3.生成.h文件 （注意 javah HelloWorld 后边不跟.class）

```
javah -jni HelloWorld
```

文件内容：

```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloWorld */

#ifndef _Included_HelloWorld
#define _Included_HelloWorld
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloWorld
 * Method:    hello
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_HelloWorld_hello
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif
```

4.实现本地方法

```
#include <jni.h>
#include "HelloWorld.h"
#include <stdio.h>
JNIEXPORT void JNICALL Java_HelloWorld_hello(JNIEnv *env,jobject obj, jstring name){

    const char *str;
    str = (*env)->GetStringUTFChars(env, name, NULL);
    if (str == NULL) {
        return;
    }

    printf("Hello World! %s \n", str );
    return;
}
```

5.生成动态链接库（二选一）

```
cl -I%java_home%\include -I%java_home%\include\win32 -LD HelloWorldImp.c -Fehello.dll

gcc -m64  -Wl,--add-stdcall-alias -I"C:\Program Files\Java\jdk1.8.0_131\include" -I"C:\Program Files\Java\jdk1.8.0_131\include\win32" -shared -o hello.dll hello.c
```

注意：生成的dll文件名在选项-Fe后面配置，这里是hello，因为在HelloWorld.java文件中我们loadLibary的时候使用的名字是hello。当然这里修改之后那里也需要修改。另外需要将-I%java_home%\include -I%java_home%\include\win32参数加上，因为在第四步里面编写本地方法的时候引入了jni.h文件。
